DROP DATABASE IF EXISTS `books`;
CREATE DATABASE IF NOT EXISTS `books`; 
USE `books`;

SET NAMES UTF8MB4;
SET character_set_client = UTF8MB4;
CREATE TABLE `BOOKS` (
	`BOOK_ID` 		int NOT NULL,
	`BOOK_NAME` 				varchar (100) NOT NULL,
	`YEAR_PUBLISHED` 			int NULL,	
	`COUNTRY_PUBLISHED` 		varchar (50) NULL,	
	`BOOK_PRICE` 				int NULL,
  	PRIMARY KEY (`BOOK_ID`),	
	INDEX `BOOK_ID` (`BOOK_ID` ASC)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE `AUTHORS` (
	`AUTHOR_ID` 		int NOT NULL,
	`AUTHOR_NAME` 			varchar (50) NOT NULL,
	`AUTHOR_EMAIL` 			varchar (50) NULL,	
	`AUTHOR_YOB` 			int NULL,
    `AUTHOR_ADDRESS` 		varchar (100) NULL,
  	PRIMARY KEY (`AUTHOR_ID`),	
	INDEX `AUTHOR_ID` (`AUTHOR_ID` ASC)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE `PUBLISHERS` (
	`PUBLISHER_ID` 		int NOT NULL,
	`PUBLISHER_NAME` 			varchar (50) NOT NULL,
	`PUBLISHER_ADDRESS` 			varchar (100) NULL,	
	`PUBLISHER_EMAIL` 			varchar (100) NULL,
  	PRIMARY KEY (`PUBLISHER_ID`),	
	INDEX `PUBLISHER_ID` (`PUBLISHER_ID` ASC)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE `EDITORS` (
	`EDITOR_ID` 		int NOT NULL,
	`EDITOR_NAME` 			varchar (50) NOT NULL,
	`EDITOR_ADDRESS` 			varchar (100) NULL,	
	`EDITOR_EMAIL` 			varchar (100) NULL,
  	PRIMARY KEY (`EDITOR_ID`),	
	INDEX `EDITOR_ID` (`EDITOR_ID` ASC)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE `CUSTOMERS` (
	`CUSTOMER_ID` 		int NOT NULL,
	`CUSTOMER_ADDRESS` 			varchar (100) NULL,
	`CUSTOMER_NAME` 			varchar (50) NOT NULL,	
  	PRIMARY KEY (`CUSTOMER_ID`),	
	INDEX `CUSTOMER_ID` (`CUSTOMER_ID` ASC)
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE `SALES` (
	`ORDER_ID` 		int NOT NULL,
	`ORDER_DATE` 		date NOT NULL,	
	`PAID_AMOUNT` 		int NOT NULL,		
	`CUSTOMER_ID` 		int NOT NULL,
	`BOOK_ID` 			int NOT NULL,	
	`QUANTITY_SOLD` 	int NOT NULL,	
  	PRIMARY KEY (`ORDER_ID`),	
	INDEX `ORDER_ID` (`ORDER_ID` ASC),
	INDEX `BOOK_ID` (`BOOK_ID` ASC),
	INDEX `CUSTOMER_ID` (`CUSTOMER_ID` ASC),	
	FOREIGN KEY (`CUSTOMER_ID`) REFERENCES `CUSTOMERS` (`CUSTOMER_ID`),
	FOREIGN KEY (`BOOK_ID`) REFERENCES `BOOKS` (`BOOK_ID`)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` (
	`BOOK_ID` 		int NOT NULL,
	`AUTHOR_ID` 		int NOT NULL,	
	`PUBLISHER_ID` 			int NOT NULL,		
	`ROYALTY_AMNT` 		int NOT NULL,	
  	PRIMARY KEY (BOOK_ID, AUTHOR_ID, PUBLISHER_ID),	
	INDEX `BOOK_ID` (`BOOK_ID` ASC),
	INDEX `AUTHOR_ID` (`AUTHOR_ID` ASC),	
    INDEX `PUBLISHER_ID` (`PUBLISHER_ID` ASC),
	FOREIGN KEY (`BOOK_ID`) REFERENCES `BOOKS` (`BOOK_ID`),
	FOREIGN KEY (`AUTHOR_ID`) REFERENCES `AUTHORS` (`AUTHOR_ID`),
    FOREIGN KEY (`PUBLISHER_ID`) REFERENCES `PUBLISHERS` (`PUBLISHER_ID`)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
CREATE TABLE `BOOK_EDITOR_RELATIONSHIP` (
	`BOOK_ID` 		int NOT NULL,
	`EDITOR_ID` 		int NOT NULL,	
  	PRIMARY KEY (BOOK_ID, EDITOR_ID),	
	INDEX `BOOK_ID` (`BOOK_ID` ASC),
	INDEX `EDITOR_ID` (`EDITOR_ID` ASC),	
	FOREIGN KEY (`BOOK_ID`) REFERENCES `BOOKS` (`BOOK_ID`),
	FOREIGN KEY (`EDITOR_ID`) REFERENCES `EDITORS` (`EDITOR_ID`)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=UTF8MB4 COLLATE=utf8mb4_0900_ai_ci;
INSERT INTO `BOOKS` VALUES(1001,'monday begins on Saturday',1965,'USSR',10);
INSERT INTO `BOOKS` VALUES(1002,'Solaris',1961,'Poland',30);
INSERT INTO `BOOKS` VALUES(1003,'hard to be a god',1964,'USSR',42);
INSERT INTO `BOOKS` VALUES(1004,'do androids dream of electric sheep',1968,'USA',66);
INSERT INTO `BOOKS` VALUES(1005,'Brave New World',1932,'UK',58);
INSERT INTO `AUTHORS` VALUES(101,'Arkady Strugatsky','N/A', 1925,'Russia; Saint-Petersburg');
INSERT INTO `AUTHORS` VALUES(102,'Boris Strugatsky','N/A', 1933,'Russia; Saint-Petersburg');
INSERT INTO `AUTHORS` VALUES(103,'Lem','N/A', 1921,'Kraków‎, Poland');
INSERT INTO `AUTHORS` VALUES(104,'Dick','N/A', 1928,'Santa Ana, CA, United States');
INSERT INTO `AUTHORS` VALUES(105,'Huxley','N/A', 1894,'Los Angeles County, California, United States');
INSERT INTO `PUBLISHERS` VALUES(91,'DAW Books','N/A', 'daw@daw.com');
INSERT INTO `PUBLISHERS` VALUES(92,'Rebellion Developments','N/A', 'rebel@rebel.com');
INSERT INTO `PUBLISHERS` VALUES(93,'Doubleday','6 Bennett St, Cambridge', 'double@double.com');
INSERT INTO `PUBLISHERS` VALUES(94,'Chatto & Windus','20 Vauxhall Bridge Rd, London', 'chatto@chatto.com');
INSERT INTO `EDITORS` VALUES(11,'Amy Mandelker','121 third steet west, Cambridge, MA', 'amy@gmail.com');
INSERT INTO `EDITORS` VALUES(12,'Nina Braddock','321 Dana street, Cambridge, MA', 'nina@gmail.com');
INSERT INTO `CUSTOMERS` VALUES(136,'123 Dana street, Cambridge, MA', 'Kate Brooks');
INSERT INTO `CUSTOMERS` VALUES(255,'22 Dana street, Cambridge, MA', 'Lana Del Ray');
INSERT INTO `CUSTOMERS` VALUES(147,'369 Dana street, Cambridge, MA', 'Random Name');
INSERT INTO `CUSTOMERS` VALUES(369,'123 Dana street, Cambridge, MA', 'Sandeep Kang');
INSERT INTO `CUSTOMERS` VALUES(324,'124 Dana street, Cambridge, MA', 'Jonathan Barks');
INSERT INTO `CUSTOMERS` VALUES(110,'987 Dana street, Cambridge, MA', 'Mao Yun');
INSERT INTO `SALES` VALUES(1000001, '2008-09-01',10, 136, 1001, 1);
INSERT INTO `SALES` VALUES(1000002, '2011-06-01',60, 255, 1002, 2);
INSERT INTO `SALES` VALUES(1000003, '2013-12-01',42, 147, 1003, 1);
INSERT INTO `SALES` VALUES(1000004, '2020-12-01',66, 369, 1004, 1);
INSERT INTO `SALES` VALUES(1000005, '2020-10-22',66, 136, 1004, 1);
INSERT INTO `SALES` VALUES(1000006, '2020-10-22',66, 136, 1002, 3);
INSERT INTO `SALES` VALUES(1000007, '2021-10-22',66, 110, 1005, 4);
INSERT INTO `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` VALUES(1001, 101,91, 120000);
INSERT INTO `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` VALUES(1001, 102,91, 15830);
INSERT INTO `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` VALUES(1002, 103,92, 12000);
INSERT INTO `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` VALUES(1003, 101,92, 136988);
INSERT INTO `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` VALUES(1003, 102,93, 12779);
INSERT INTO `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` VALUES(1004, 104,93, 33579120);
INSERT INTO `BOOK_AUTHOR_PUBLISHER_RELATIONSHIP` VALUES(1005, 105,94, 12778);
INSERT INTO `BOOK_EDITOR_RELATIONSHIP` VALUES(1001, 11);
INSERT INTO `BOOK_EDITOR_RELATIONSHIP` VALUES(1002, 12);
INSERT INTO `BOOK_EDITOR_RELATIONSHIP` VALUES(1003, 11);
INSERT INTO `BOOK_EDITOR_RELATIONSHIP` VALUES(1003, 12);
INSERT INTO `BOOK_EDITOR_RELATIONSHIP` VALUES(1004, 12);
INSERT INTO `BOOK_EDITOR_RELATIONSHIP` VALUES(1005, 11);

select AUTHOR_NAME, COUNT(DISTINCT BOOK_NAME) from BOOK_AUTHOR_PUBLISHER_RELATIONSHIP as R
left join books as B
on r.BOOK_ID = B.BOOK_ID
left join authors as A
on r.AUTHOR_ID = A.AUTHOR_ID
GROUP BY AUTHOR_NAME

select B.BOOK_NAME, COUNT(DISTINCT AUTHOR_NAME) from BOOK_AUTHOR_PUBLISHER_RELATIONSHIP as R
left join books as B
on r.BOOK_ID = B.BOOK_ID
left join authors as A
on r.AUTHOR_ID = A.AUTHOR_ID
GROUP BY BOOK_NAME

select AUTHOR_NAME, sum(ROYALTY_AMNT) AS TOTAL_ROYALTY from BOOK_AUTHOR_PUBLISHER_RELATIONSHIP as R
left join books as B
on r.BOOK_ID = B.BOOK_ID
left join authors as A
on r.AUTHOR_ID = A.AUTHOR_ID
GROUP BY AUTHOR_NAME

select AUTHOR_NAME, BOOK_NAME, sum(ROYALTY_AMNT) AS TOTAL_ROYALTY from BOOK_AUTHOR_PUBLISHER_RELATIONSHIP as R
left join books as B
on r.BOOK_ID = B.BOOK_ID
left join authors as A
on r.AUTHOR_ID = A.AUTHOR_ID
GROUP BY AUTHOR_NAME

select PUBLISHER_NAME, count(distinct BOOK_NAME) from BOOK_AUTHOR_PUBLISHER_RELATIONSHIP as R
left join books as B
on r.BOOK_ID = B.BOOK_ID
left join authors as A
on r.AUTHOR_ID = A.AUTHOR_ID
left join publishers as P
on P.Publisher_Id = R.Publisher_Id
GROUP BY AUTHOR_NAME


select EDITOR_NAME, count(distinct BOOK_NAME) from BOOK_EDITOR_RELATIONSHIP as E
left join books as B
on E.BOOK_ID = B.BOOK_ID
left join editors as ED
on ED.EDITOR_ID = E.EDITOR_ID
GROUP BY EDITOR_NAME


select BOOK_NAME, count(distinct EDITOR_NAME) as 'number of editors 'from BOOK_EDITOR_RELATIONSHIP as E
left join books as B
on E.BOOK_ID = B.BOOK_ID
left join editors as ED
on ED.EDITOR_ID = E.EDITOR_ID
GROUP BY BOOK_NAME

select ORDER_ID , sum(Quantity_SOLD) as 'books in order' from sales
group by ORDER_ID

select b.BOOK_NAME , sum(Quantity_SOLD) as 'sales per book' from sales as S
left join books as b
on b.BOOK_ID = s.BOOK_ID
group by BOOK_NAME

select CUSTOMER_NAME, ORDER_ID from customers as c
left join sales as s
on c.CUSTOMER_ID = s.CUSTOMER_ID

select CUSTOMER_NAME, count(ORDER_ID) as 'Orders per customer' from customers as c
left join sales as s
on c.CUSTOMER_ID = s.CUSTOMER_ID
group by CUSTOMER_NAME


